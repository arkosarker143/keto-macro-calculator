<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keto Macro Calculator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Keto Macro Calculator</h1>
        <form id="keto-form">
            <div class="half-width">
                <label for="gender">Gender:</label>
                <select id="gender">
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                </select>

                <label for="age">Age:</label>
                <input type="number" id="age" required>

                <label for="weight">Weight (kg):</label>
                <input type="number" id="weight" required>

                <label for="height">Height (cm):</label>
                <input type="number" id="height" required>
            </div>

            <div class="half-width">
                <label for="activity">Activity Level:</label>
                <select id="activity">
                    <option value="sedentary">Sedentary</option>
                    <option value="light">Light Activity</option>
                    <option value="moderate">Moderate Activity</option>
                    <option value="active">Active</option>
                </select>

                <label for="goal">Goal:</label>
                <select id="goal">
                    <option value="weightloss">Weight Loss</option>
                    <option value="maintenance">Maintenance</option>
                    <option value="muscle">Muscle Gain</option>
                </select>

                <div class="full-width">
                    <label for="mode">Calculator Mode:</label>
                    <select id="mode" onchange="toggleAdvancedMode()">
                        <option value="basic">Basic</option>
                        <option value="advanced">Advanced</option>
                    </select>
                </div>

                <!-- Advanced Mode Inputs -->
                <div id="advanced-mode" style="display:none;">
                    <label for="fat">Fat %:</label>
                    <input type="number" id="fat" placeholder="Enter Fat Percentage" min="0" max="100">
                    
                    <label for="protein">Protein %:</label>
                    <input type="number" id="protein" placeholder="Enter Protein Percentage" min="0" max="100">
                    
                    <label for="carbs">Carbs %:</label>
                    <input type="number" id="carbs" placeholder="Enter Carbs Percentage" min="0" max="100">
                </div>
            </div>

            <button type="button" onclick="calculateMacros()">Calculate</button>
            <button type="button" onclick="clearForm()">Clear</button>
            <button type="button" onclick="saveToLocalStorage()">Save</button>
        </form>

        <div id="result"></div>
        <div id="chart-container">
            <canvas id="myChart"></canvas>
        </div>

        <div id="planner">
            <h2>Weekly Macro Planner</h2>
            <div id="weekly-planner">
                <div class="planner-day">Mon: <span id="monday-macro">0g</span></div>
                <div class="planner-day">Tue: <span id="tuesday-macro">0g</span></div>
                <div class="planner-day">Wed: <span id="wednesday-macro">0g</span></div>
                <div class="planner-day">Thu: <span id="thursday-macro">0g</span></div>
                <div class="planner-day">Fri: <span id="friday-macro">0g</span></div>
                <div class="planner-day">Sat: <span id="saturday-macro">0g</span></div>
                <div class="planner-day">Sun: <span id="sunday-macro">0g</span></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        function toggleAdvancedMode() {
            const mode = document.getElementById('mode').value;
            document.getElementById('advanced-mode').style.display = mode === 'advanced' ? 'block' : 'none';
        }

        function validateInputs() {
            let isValid = true;
            const age = document.getElementById('age').value;
            const weight = document.getElementById('weight').value;
            const height = document.getElementById('height').value;

            if (age <= 0 || age > 120) {
                alert('Please enter a valid age.');
                isValid = false;
            }

            if (weight <= 0) {
                alert('Please enter a valid weight.');
                isValid = false;
            }

            if (height <= 0) {
                alert('Please enter a valid height.');
                isValid = false;
            }

            return isValid;
        }

        function calculateMacros() {
            if (!validateInputs()) return;

            const gender = document.getElementById('gender').value;
            const age = parseInt(document.getElementById('age').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);
            const activityLevel = document.getElementById('activity').value;
            const goal = document.getElementById('goal').value;

            let bmr;

            if (gender === 'male') {
                bmr = 88.362 + (13.397 * weight) + (4.799 * height) - (5.677 * age);
            } else {
                bmr = 447.593 + (9.247 * weight) + (3.098 * height) - (4.330 * age);
            }

            let tdee;
            const activityFactors = {
                sedentary: 1.2,
                light: 1.375,
                moderate: 1.55,
                active: 1.725,
            };

            tdee = bmr * activityFactors[activityLevel];

            let fatPercentage, proteinPercentage, carbsPercentage;

            if (document.getElementById('mode').value === 'basic') {
                if (goal === 'weightloss') {
                    fatPercentage = 0.75; proteinPercentage = 0.20; carbsPercentage = 0.05;
                } else if (goal === 'maintenance') {
                    fatPercentage = 0.60; proteinPercentage = 0.30; carbsPercentage = 0.10;
                } else {
                    fatPercentage = 0.50; proteinPercentage = 0.30; carbsPercentage = 0.20;
                }
            } else {
                fatPercentage = parseFloat(document.getElementById('fat').value) / 100;
                proteinPercentage = parseFloat(document.getElementById('protein').value) / 100;
                carbsPercentage = parseFloat(document.getElementById('carbs').value) / 100;

                const totalPercentage = fatPercentage + proteinPercentage + carbsPercentage;
                if (totalPercentage !== 1) {
                    alert('Please ensure that the sum of fat, protein, and carbs percentages equals 100%.');
                    return;
                }
            }

            const totalFat = tdee * fatPercentage;
            const totalProtein = tdee * proteinPercentage;
            const totalCarbs = tdee * carbsPercentage;

            const fatGrams = (totalFat / 9).toFixed(2);
            const proteinGrams = (totalProtein / 4).toFixed(2);
            const carbGrams = (totalCarbs / 4).toFixed(2);

            document.getElementById('result').innerHTML = `
                <h2>Your Results:</h2>
                <p><strong>BMR:</strong> ${bmr.toFixed(2)} kcal</p>
                <p><strong>TDEE:</strong> ${tdee.toFixed(2)} kcal</p>
                <p><strong>Fat:</strong> ${fatGrams} g</p>
                <p><strong>Protein:</strong> ${proteinGrams} g</p>
                <p><strong>Carbs:</strong> ${carbGrams} g</p>
            `;

            renderChart(fatGrams, proteinGrams, carbGrams);
            updateWeeklyPlanner(fatGrams, proteinGrams, carbGrams);
        }

        function renderChart(fatGrams, proteinGrams, carbGrams) {
            const ctx = document.getElementById('myChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Fat', 'Protein', 'Carbs'],
                    datasets: [{
                        data: [fatGrams, proteinGrams, carbGrams],
                        backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56'],
                        hoverBackgroundColor: ['#FF6384', '#36A2EB', '#FFCE56']
                    }]
                },
                options: {
                    responsive: true
                }
            });
        }

        function updateWeeklyPlanner(fatGrams, proteinGrams, carbGrams) {
            const dailyFat = (fatGrams / 7).toFixed(2);
            const dailyProtein = (proteinGrams / 7).toFixed(2);
            const dailyCarbs = (carbGrams / 7).toFixed(2);

            document.getElementById('monday-macro').innerText = dailyFat + "g Fat, " + dailyProtein + "g Protein, " + dailyCarbs + "g Carbs";
            // Repeat for other days...
            document.getElementById('tuesday-macro').innerText = dailyFat + "g Fat, " + dailyProtein + "g Protein, " + dailyCarbs + "g Carbs";
            document.getElementById('wednesday-macro').innerText = dailyFat + "g Fat, " + dailyProtein + "g Protein, " + dailyCarbs + "g Carbs";
            document.getElementById('thursday-macro').innerText = dailyFat + "g Fat, " + dailyProtein + "g Protein, " + dailyCarbs + "g Carbs";
            document.getElementById('friday-macro').innerText = dailyFat + "g Fat, " + dailyProtein + "g Protein, " + dailyCarbs + "g Carbs";
            document.getElementById('saturday-macro').innerText = dailyFat + "g Fat, " + dailyProtein + "g Protein, " + dailyCarbs + "g Carbs";
            document.getElementById('sunday-macro').innerText = dailyFat + "g Fat, " + dailyProtein + "g Protein, " + dailyCarbs + "g Carbs";
        }

        function clearForm() {
            document.getElementById('keto-form').reset();
            document.getElementById('result').innerHTML = '';
            document.getElementById('weekly-planner').innerHTML = '';
            document.getElementById('chart-container').style.display = 'none';
        }

        function saveToLocalStorage() {
            const formData = {
                gender: document.getElementById('gender').value,
                age: document.getElementById('age').value,
                weight: document.getElementById('weight').value,
                height: document.getElementById('height').value,
                activity: document.getElementById('activity').value,
                goal: document.getElementById('goal').value,
                mode: document.getElementById('mode').value,
                fat: document.getElementById('fat').value,
                protein: document.getElementById('protein').value,
                carbs: document.getElementById('carbs').value
            };
            localStorage.setItem('ketoFormData', JSON.stringify(formData));
            alert('Data saved!');
        }

        window.onload = function() {
            const storedData = JSON.parse(localStorage.getItem('ketoFormData'));
            if (storedData) {
                document.getElementById('gender').value = storedData.gender;
                document.getElementById('age').value = storedData.age;
                document.getElementById('weight').value = storedData.weight;
                document.getElementById('height').value = storedData.height;
                document.getElementById('activity').value = storedData.activity;
                document.getElementById('goal').value = storedData.goal;
                document.getElementById('mode').value = storedData.mode;
                document.getElementById('fat').value = storedData.fat;
                document.getElementById('protein').value = storedData.protein;
                document.getElementById('carbs').value = storedData.carbs;
                toggleAdvancedMode(); // Ensure advanced mode is shown if applicable
            }
        };
    </script>
</body>
</html>
